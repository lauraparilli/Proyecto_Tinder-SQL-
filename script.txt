SET search_path TO tinder_viejos_egresados, public;
SET DATASTYLE TO 'European';

CREATE TABLE IF NOT EXISTS cuenta(
	id_cuenta INT GENERATED ALWAYS AS IDENTITY,
	nombre VARCHAR(16) NOT NULL,
	apellido VARCHAR(16) NOT NULL,
	fecha_nacimiento DATE NOT NULL,
	fecha_creacion DATE NOT NULL DEFAULT CURRENT_DATE,
	email VARCHAR(255) UNIQUE,
	contrasena VARCHAR(128) NOT NULL,
	telefono VARCHAR(13),
	idioma VARCHAR(3) DEFAULT 'ESP' NOT NULL,
	notificaciones BOOLEAN DEFAULT TRUE NOT NULL, 
	tema BOOLEAN DEFAULT TRUE NOT NULL,
	PRIMARY KEY (id_cuenta)
);

CREATE TABLE IF NOT EXISTS pago(
	id_pago INT GENERATED ALWAYS AS IDENTITY,
	numero_factura INT NOT NULL,
	aprobado BOOLEAN NOT NULL,
	metodo VARCHAR(7) NOT NULL,
	monto INT DEFAULT 0 NOT NULL,
	fecha DATE NOT NULL DEFAULT CURRENT_DATE, 
	documento_factura BYTEA NOT NULL,
 PRIMARY KEY (id_pago)
	
);

CREATE TABLE IF NOT EXISTS tarjeta (
    digitos_tarjeta VARCHAR(19) CHECK (numero_tarjeta ~ '^[0-9]{16,19}$'),
	nombre_titular VARCHAR(32) NOT NULL,
	fecha_caducidad DATE NOT NULL,
	codigo_cv VARCHAR(3) CHECK (codigo_cv ~ '^[0-9]{3}$'),
	tipo VARCHAR(15) NOT NULL
	PRIMARY KEY(digitos_tarjeta)
);

CREATE TABLE IF NOT EXISTS institucion (
    dominio VARCHAR(64),
    nombre VARCHAR(32) NOT NULL,
    coordenada VARCHAR(30) NOT NULL,
    tipo VARCHAR(32),
    anio_fundacion INT NOT NULL,
	PRIMARY KEY(dominio)
);

CREATE TABLE IF NOT EXISTS mensaje (
    id_chat INT,
	numero_msj INT GENERATED,
	id_remitente INT NOT NULL,
	id_destinatario INT NOT NULL,
	visto BOOLEAN DEFAULT FALSE,
	texto BYTEA NOT NULL,
	timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY(id_chat, numero_msg),
	FOREIGN KEY(id_chat), REFERENCES chat(id_chat)
)
