CREATE TABLE IF NOT EXISTS swipes (
    id_disliker INT,
    id_disliked INT,
    PRIMARY KEY (id_disliker, id_disliked),
    CONSTRAINT fk_id_disliker_cuenta
    FOREIGN KEY (id_disliker) REFERENCES cuenta(id_cuenta),
    CONSTRAINT fk_id_disliked_cuenta
    FOREIGN KEY (id_disliked) REFERENCES cuenta(id_cuenta)
);

CREATE TABLE IF NOT EXISTS trabaja_en (
    id_cuenta INT,
    id_perfil INT,
    idempresa INT,
    cargo VARCHAR(24) NOT NULL,
    fecha_inicio DATE NOT NULL,
    PRIMARY KEY(id_cuenta, id_perfil, idempresa),
    CONSTRAINT fk_id_cuenta_id_perfil_perfil
        FOREIGN KEY(id_cuenta, id_perfil) REFERENCES perfil(id_cuenta, id_perfil)
        ON UPDATE CASCADE ON DELETE CASCADE,
    CONSTRAINT fk_idempresa_empresa
        FOREIGN KEY(idempresa) REFERENCES empresa(idempresa)
        ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS tarjeta (
    digitos_tarjeta VARCHAR(19) CHECK (numero_tarjeta ~ '^[0-9]{16,19}$'),
	nombre_titular VARCHAR(32) NOT NULL,
	fecha_caducidad DATE NOT NULL,
	codigo_cv VARCHAR(3) CHECK (codigo_cv ~ '^[0-9]{3}$'),
	tipo VARCHAR(15) NOT NULL
	PRIMARY KEY(digitos_tarjeta)
);

CREATE TABLE IF NOT EXISTS institucion (
    dominio VARCHAR(64),
    nombre VARCHAR(32) NOT NULL,
    coordenada VARCHAR(30) NOT NULL,
    tipo VARCHAR(32),
    anio_fundacion INT NOT NULL,
	PRIMARY KEY(dominio)
);

CREATE TABLE IF NOT EXISTS mensaje (
    id_chat INT,
	numero_msj INT GENERATED,
	id_remitente INT NOT NULL,
	id_destinatario INT NOT NULL,
	visto BOOLEAN DEFAULT FALSE,
	texto BYTEA NOT NULL,
	timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY(id_chat, numero_msg),
	FOREIGN KEY(id_chat), REFERENCESÂ chat(id_chat)
);

CREATE TABLE IF NOT EXISTS tiene_hobby (
    id_cuenta INT,
    id_perfil INT,
    hobby VARCHAR(64),
    PRIMARY KEY(id_cuenta, id_perfil, hobby),
    CONSTRAINT fk_id_cuenta_id_perfil_perfil
        FOREIGN KEY(id_cuenta, id_perfil) REFERENCES perfil(id_cuenta, id_perfil)
        ON UPDATE CASCADE ON DELETE CASCADE
);
